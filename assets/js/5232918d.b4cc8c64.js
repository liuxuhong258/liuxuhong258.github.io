"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[57],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>g});var a=t(7294);function l(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){l(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function p(e,n){if(null==e)return{};var t,a,l=function(e,n){if(null==e)return{};var t,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(l[t]=e[t]);return l}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(l[t]=e[t])}return l}var r=a.createContext({}),s=function(e){var n=a.useContext(r),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=s(e.components);return a.createElement(r.Provider,{value:n},e.children)},u="mdxType",k={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,l=e.mdxType,i=e.originalType,r=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),u=s(t),m=l,g=u["".concat(r,".").concat(m)]||u[m]||k[m]||i;return t?a.createElement(g,o(o({ref:n},c),{},{components:t})):a.createElement(g,o({ref:n},c))}));function g(e,n){var t=arguments,l=n&&n.mdxType;if("string"==typeof e||l){var i=t.length,o=new Array(i);o[0]=m;var p={};for(var r in n)hasOwnProperty.call(n,r)&&(p[r]=n[r]);p.originalType=e,p[u]="string"==typeof e?e:l,o[1]=p;for(var s=2;s<i;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},9639:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>p,toc:()=>s});var a=t(7462),l=(t(7294),t(3905));const i={},o="plugin \u539f\u7406",p={unversionedId:"webpack/plugin",id:"webpack/plugin",title:"plugin \u539f\u7406",description:"plugin \u7684\u4f5c\u7528",source:"@site/docs/webpack/plugin.md",sourceDirName:"webpack",slug:"/webpack/plugin",permalink:"/docs/webpack/plugin",draft:!1,editUrl:"https://github.com/liuxuhong258/liuxuhong258.github.io/blob/gh-pages/docs/webpack/plugin.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"loader \u539f\u7406",permalink:"/docs/webpack/loader"},next:{title:"\u9ad8\u7ea7\u4f18\u5316",permalink:"/docs/webpack/senior"}},r={},s=[{value:"plugin \u7684\u4f5c\u7528",id:"plugin-\u7684\u4f5c\u7528",level:2},{value:"plugin \u5de5\u4f5c\u539f\u7406",id:"plugin-\u5de5\u4f5c\u539f\u7406",level:2},{value:"webpack \u5185\u90e8\u7684\u94a9\u5b50",id:"webpack-\u5185\u90e8\u7684\u94a9\u5b50",level:2},{value:"\u4ec0\u4e48\u662f\u94a9\u5b50",id:"\u4ec0\u4e48\u662f\u94a9\u5b50",level:3},{value:"Tapable",id:"tapable",level:3},{value:"plugin \u6784\u5efa\u5bf9\u8c61",id:"plugin-\u6784\u5efa\u5bf9\u8c61",level:2},{value:"Compiler",id:"compiler",level:3},{value:"Compilation",id:"compilation",level:3},{value:"\u6700\u7b80\u5355\u7684\u63d2\u4ef6",id:"\u6700\u7b80\u5355\u7684\u63d2\u4ef6",level:2},{value:"\u6ce8\u518c hooks",id:"\u6ce8\u518c-hooks",level:2},{value:"BannerWebpackPlugin",id:"bannerwebpackplugin",level:2},{value:"CleanWebpackPlugin",id:"cleanwebpackplugin",level:2},{value:"AnalyzeWepackPlugin",id:"analyzewepackplugin",level:2},{value:"InlineChunkWebpackPlugin",id:"inlinechunkwebpackplugin",level:2}],c={toc:s};function u(e){let{components:n,...t}=e;return(0,l.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"plugin-\u539f\u7406"},"plugin \u539f\u7406"),(0,l.kt)("h2",{id:"plugin-\u7684\u4f5c\u7528"},"plugin \u7684\u4f5c\u7528"),(0,l.kt)("p",null,"\u901a\u8fc7\u63d2\u4ef6\u6211\u4eec\u53ef\u4ee5\u6269\u5c55 webpack\uff0c\u52a0\u5165\u81ea\u5b9a\u4e49\u7684\u6269\u5c55\u884c\u4e3a\uff0c\u4f7f webpack \u53ef\u4ee5\u6267\u884c\u66f4\u5e7f\u6cdb\u7684\u4efb\u52a1\uff0c\u62e5\u6709\u66f4\u5f3a\u7684\u6784\u5efa\u80fd\u529b\u3002"),(0,l.kt)("h2",{id:"plugin-\u5de5\u4f5c\u539f\u7406"},"plugin \u5de5\u4f5c\u539f\u7406"),(0,l.kt)("blockquote",null,(0,l.kt)("p",{parentName:"blockquote"},"webpack \u5c31\u50cf\u4e00\u6761\u751f\u4ea7\u7ebf\uff0c\u8981\u7ecf\u8fc7\u4e00\u7cfb\u5217\u5904\u7406\u6d41\u7a0b\u540e\u624d\u80fd\u5c06\u6e90\u6587\u4ef6\u8f6c\u6362\u6210\u8f93\u51fa\u7ed3\u679c\u3002\u8fd9\u6761\u751f\u4ea7\u7ebf\u4e0a\u7684\u6bcf\u4e2a\u5904\u7406\u6d41\u7a0b\u7684\u804c\u8d23\u90fd\u662f\u5355\u4e00\u7684\uff0c\u591a\u4e2a\u6d41\u7a0b\u4e4b\u95f4\u6709\u5b58\u5728\u4f9d\u8d56\u5173\u7cfb\uff0c\u53ea\u6709\u5b8c\u6210\u5f53\u524d\u5904\u7406\u540e\u624d\u80fd\u4ea4\u7ed9\u4e0b\u4e00\u4e2a\u6d41\u7a0b\u53bb\u5904\u7406\u3002\u63d2\u4ef6\u5c31\u50cf\u662f\u4e00\u4e2a\u63d2\u5165\u5230\u751f\u4ea7\u7ebf\u4e2d\u7684\u4e00\u4e2a\u529f\u80fd\uff0c\u5728\u7279\u5b9a\u7684\u65f6\u673a\u5bf9\u751f\u4ea7\u7ebf\u4e0a\u7684\u8d44\u6e90\u505a\u5904\u7406\u3002webpack \u901a\u8fc7 Tapable \u6765\u7ec4\u7ec7\u8fd9\u6761\u590d\u6742\u7684\u751f\u4ea7\u7ebf\uff0cwebpack \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u4f1a\u5e7f\u64ad\u4e8b\u4ef6\uff0c\u63d2\u4ef6\u53ea\u9700\u8981\u76d1\u542c\u5b83\u6240\u5173\u5fc3\u7684\u4e8b\u4ef6\uff0c\u5c31\u80fd\u52a0\u5165\u5230\u8fd9\u6761\u751f\u4ea7\u7ebf\u4e2d\uff0c\u53bb\u6539\u53d8\u751f\u4ea7\u7ebf\u7684\u8fd0\u4f5c\u3002webpack \u7684\u4e8b\u4ef6\u673a\u5236\u4fdd\u8bc1\u4e86\u63d2\u4ef6\u7684\u6709\u5e8f\u6027\uff0c\u4f7f\u5f97\u6574\u4e2a\u7cfb\u7edf\u6269\u5c55\u6027\u5f88\u597d\u3002\u2014\u2014","[\u6df1\u5165\u6d45\u51fa Webpack]",(0,l.kt)("br",{parentName:"p"}),"\n","\u7ad9\u5728\u4ee3\u7801\u903b\u8f91\u7684\u89d2\u5ea6\u5c31\u662f\uff1awebpack \u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u89e6\u53d1\u4e00\u7cfb\u5217 ",(0,l.kt)("strong",{parentName:"p"},"Tapable")," \u94a9\u5b50\u4e8b\u4ef6\uff0c\u63d2\u4ef6\u6240\u505a\u7684\uff0c\u5c31\u662f\u627e\u5230\u81ea\u5df1\u7684\u94a9\u5b50\uff0c\u5f80\u4e0a\u9762\u6302\u4e0a\u81ea\u5df1\u7684\u4efb\u52a1\uff0c\u4e5f\u5c31\u662f\u6ce8\u518c\u4e8b\u4ef6\uff0c\u8fd9\u6837\uff0c\u5f53 webpack \u6784\u5efa\u7684\u65f6\u5019\uff0c\u63d2\u4ef6\u6ce8\u518c\u7684\u4e8b\u4ef6\u5c31\u4f1a\u968f\u7740\u94a9\u5b50\u7684\u89e6\u53d1\u6267\u884c\u4e86\u3002")),(0,l.kt)("h2",{id:"webpack-\u5185\u90e8\u7684\u94a9\u5b50"},"webpack \u5185\u90e8\u7684\u94a9\u5b50"),(0,l.kt)("h3",{id:"\u4ec0\u4e48\u662f\u94a9\u5b50"},"\u4ec0\u4e48\u662f\u94a9\u5b50"),(0,l.kt)("p",null,"\u94a9\u5b50\u7684\u672c\u8d28\u5c31\u662f\u4e8b\u4ef6\u3002\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u76f4\u63a5\u4ecb\u5165\u548c\u63a7\u5236\u7f16\u8bd1\u8fc7\u7a0b\uff0cwebpack \u628a\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u89e6\u53d1\u7684\u5404\u7c7b\u5173\u952e\u4e8b\u4ef6\u5c01\u88c5\u6210\u4e8b\u4ef6\u63a5\u53e3\u66b4\u9732\u4e86\u51fa\u6765\uff0c\u8fd9\u4e9b\u63a5\u53e3\u88ab\u5f62\u8c61\u5730\u79f0\u4f5c hooks(\u94a9\u5b50)\u3002\u5f00\u53d1\u63d2\u4ef6\uff0c\u79bb\u4e0d\u5f00\u8fd9\u4e9b\u94a9\u5b50\u3002"),(0,l.kt)("h3",{id:"tapable"},"Tapable"),(0,l.kt)("p",null,"Tapable \u4e3a webpack \u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u63d2\u4ef6\u63a5\u53e3\u7c7b\u578b\u5b9a\u4e49\uff0c\u5b83\u662f webapck \u7684\u6838\u5fc3\u529f\u80fd\u5e93\uff0cwebpack \u4e2d\u76ee\u524d\u6709\u5341\u79cd hooks\uff0c\u5728 tapable \u6e90\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","Tapable \u8fd8\u7edf\u4e00\u66b4\u9732\u4e86 3 \u4e2a\u65b9\u6cd5\u7ed9\u63d2\u4ef6\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"tap \u53ef\u4ee5\u6ce8\u518c\u540c\u6b65\u94a9\u5b50\u548c\u5f02\u6b65\u94a9\u5b50"),(0,l.kt)("li",{parentName:"ul"},"tapAsync \u56de\u8c03\u65b9\u5f0f\u6ce8\u518c\u5f02\u6b65\u94a9\u5b50"),(0,l.kt)("li",{parentName:"ul"},"tapPromise Promise \u65b9\u5f0f\u6ce8\u518c\u5f02\u6b65\u94a9\u5b50")),(0,l.kt)("h2",{id:"plugin-\u6784\u5efa\u5bf9\u8c61"},"plugin \u6784\u5efa\u5bf9\u8c61"),(0,l.kt)("h3",{id:"compiler"},"Compiler"),(0,l.kt)("p",null,"compiler \u4e2d\u4fdd\u5b58\u7740\u5b8c\u6574\u7684 webpack \u73af\u5883\u914d\u7f6e\uff0c\u6bcf\u6b21\u542f\u52a8 webpack \u6784\u5efa\u65f6\u5b83\u90fd\u662f\u4e00\u4e2a\u72ec\u4e00\u65e0\u4e8c\u4ec5\u4ec5\u4f1a\u521b\u5efa\u4e00\u6b21\u7684\u5bf9\u8c61\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u8fd9\u4e2a\u5bf9\u8c61\u4f1a\u5728\u9996\u6b21\u542f\u52a8 webpack \u65f6\u521b\u5efa\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 compiler \u5bf9\u8c61\u8bbf\u95ee\u5230 webpack \u7684\u4e3b\u73af\u5883\u914d\u7f6e\uff0c\u6bd4\u5982 loader, plugin \u7b49\u914d\u7f6e\u4fe1\u606f\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u5b83\u6709\u4ee5\u4e0b\u4e3b\u8981\u5c5e\u6027\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"compiler.options \u53ef\u4ee5\u8bbf\u95ee\u672c\u6b21\u542f\u52a8 webpack \u65f6\u5019\u6240\u6709\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e loaders, entry, output, plugins \u7b49\u7b49\u5b8c\u6574\u914d\u7f6e\u4fe1\u606f\u3002"),(0,l.kt)("li",{parentName:"ul"},"compiler.inputFileSystem \u548c compiler.outputFileSystem \u53ef\u4ee5\u8fdb\u884c\u6587\u4ef6\u64cd\u4f5c\uff0c\u76f8\u5f53\u4e8e node.js \u4e2d\u7684 fs."),(0,l.kt)("li",{parentName:"ul"},"compiler.hooks \u53ef\u4ee5\u6ce8\u518c tapable \u7684\u4e0d\u540c\u79cd\u7c7b hook\uff0c\u4ece\u800c\u53ef\u4ee5\u5728 compiler \u751f\u547d\u5468\u671f\u4e2d\u690d\u5165\u4e0d\u540c\u7684\u903b\u8f91")),(0,l.kt)("h3",{id:"compilation"},"Compilation"),(0,l.kt)("p",null,"compilation \u5bf9\u8c61\u4ee3\u8868\u4e00\u6b21\u8d44\u6e90\u7684\u6784\u5efa\uff0ccompilation \u5b9e\u4f8b\u53ef\u4ee5\u8bbf\u95ee\u6240\u6709\u7684\u6a21\u5757\u548c\u4ed6\u4eec\u7684\u4f9d\u8d56\u3002",(0,l.kt)("br",{parentName:"p"}),"\n","\u4e00\u4e2a compilation \u5bf9\u8c61\u4f1a\u5bf9\u6784\u5efa\u4f9d\u8d56\u56fe\u4e2d\u6240\u6709\u6a21\u5757\u8fdb\u884c\u7f16\u8bd1\u3002\u5728\u7f16\u8bd1\u9636\u6bb5\uff0c\u6a21\u5757\u4f1a\u88ab\u52a0\u8f7d(load)\uff0c\u5c01\u5b58(seal)\uff0c\u4f18\u5316(optimize)\uff0c\u5206\u5757(chunk)\uff0c\u54c8\u5e0c(hash)\u548c\u91cd\u65b0\u521b\u5efa(restore)\u3002\n\u5b83\u6709\u4ee5\u4e0b\u4e3b\u8981\u5c5e\u6027\uff1a"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"compilation.modules \u53ef\u4ee5\u8bbf\u95ee\u6240\u6709\u6a21\u5757\uff0c\u6253\u5305\u7684\u6bcf\u4e00\u4e2a\u6587\u4ef6\u90fd\u662f\u4e00\u4e2a\u6a21\u5757\u3002"),(0,l.kt)("li",{parentName:"ul"},"compilation.chunks chunk \u5373\u662f\u591a\u4e2a modules \u7ec4\u6210\u800c\u6765\u7684\u4e00\u4e2a\u4ee3\u7801\u5757\u3002\u5165\u53e3\u6587\u4ef6\u5f15\u5165\u7684\u8d44\u6e90\u7ec4\u6210\u4e00\u4e2a chunk\uff0c\u901a\u8fc7\u4ee3\u7801\u5206\u5272\u7684\u6a21\u5757\u53c8\u662f\u53e6\u4e00\u4e2a chunk\u3002"),(0,l.kt)("li",{parentName:"ul"},"compilation.assets \u53ef\u4ee5\u8bbf\u95ee\u672c\u6b21\u6253\u5305\u751f\u6210\u7684\u6240\u6709\u6587\u4ef6\u7684\u7ed3\u679c\u3002"),(0,l.kt)("li",{parentName:"ul"},"compilation.hooks \u53ef\u4ee5\u6ce8\u518c tapable \u7684\u4e0d\u540c\u79cd\u7c7b hook\uff0c\u7528\u4e8e\u5728 compilation \u7f16\u8bd1\u6a21\u5757\u9636\u6bb5\u8fdb\u884c\u903b\u8f91\u6dfb\u52a0\u4ee5\u53ca\u4fee\u6539\u3002")),(0,l.kt)("h2",{id:"\u6700\u7b80\u5355\u7684\u63d2\u4ef6"},"\u6700\u7b80\u5355\u7684\u63d2\u4ef6"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-javascript"},"/**\n * 1. webpack\u52a0\u8f7dwebpack.config.js\u4e2d\u6240\u6709\u914d\u7f6e\uff0c\u6b64\u65f6\u5c31\u4f1a new Terser(),\n * \u6267\u884c\u63d2\u4ef6\u7684constructor\n * 2. webpack\u521b\u5efacompiler\u5bf9\u8c61\n * 3. \u904d\u5386plugins\u4e2d\u6240\u6709\u63d2\u4ef6\uff0c\u8c03\u7528\u63d2\u4ef6\u7684apply\u65b9\u6cd5\n * 4. \u6267\u884c\u5269\u4e0b\u7f16\u8bd1\u6d41\u7a0b\uff08\u89e6\u53d1\u5404\u4e2ahooks\u4e8b\u4ef6\uff09\n */\nclass TerserPlugin {\n  constructor() {}\n  apply(compiler) {}\n}\nmodule.exports = TerserPlugin;\n")),(0,l.kt)("h2",{id:"\u6ce8\u518c-hooks"},"\u6ce8\u518c hooks"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'class TerserPlugin {\n  constructor() {}\n  apply(compiler) {\n    compiler.hooks.environment.tap("TerserPlugin", () => {});\n    // emit\u6ce8\u518c\u4e86\u591a\u4e2a\u4e8b\u4ef6 \u5f02\u6b65\u4e32\u884c AsyncSeriesHook\n    conpiler.hooks.emit.tap("TerserPlugin", (compilation) => {});\n    conpiler.hooks.emit.tapAsync("TerserPlugin", (compilation, callback) => {\n      setTimeout(() => {\n        callback();\n      }, 1000);\n    });\n    conpiler.hooks.emit.tapPromise("TerserPlugin", (compilation) => {\n      return new Promise((resolve) => {\n        setTimeout(() => {\n          resolve();\n        }, 1000);\n      });\n    });\n    // \u7531\u6587\u6863\u53ef\u77e5\uff0cmake\u662f\u5f02\u6b65\u5e76\u884c\u94a9\u5b50 AsyncParallelHook\n    compiler.hooks.make.tapAsync("TerserPlugin", (compilation, callback) => {\n      // \u9700\u8981\u5728compilation hooks\u89e6\u53d1\u524d\u6ce8\u518c\u624d\u80fd\u4f7f\u7528\n      compilation.hooks.seal.tap("TerserPlugin", () => {});\n    });\n  }\n}\nmodule.exports = TerserPlugin;\n')),(0,l.kt)("h2",{id:"bannerwebpackplugin"},"BannerWebpackPlugin"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'/**\n * \u7ed9\u6253\u5305\u8f93\u51fa\u6587\u4ef6\u6dfb\u52a0\u6ce8\u91ca\n * 1. \u9700\u8981\u6253\u5305\u8f93\u51fa\u524d\u6dfb\u52a0\u6ce8\u91ca\uff1a\u9700\u8981\u4f7f\u7528compiler.hooks.emit\u94a9\u5b50\uff0c\u5b83\u662f\u6253\u5305\u8f93\u51fa\u524d\u89e6\u53d1\u3002\n * 2. \u5982\u4f55\u83b7\u53d6\u6253\u5305\u8f93\u51fa\u7684\u8d44\u6e90\uff1fcompilation.assets\u53ef\u4ee5\u83b7\u53d6\u5373\u5c06\u8f93\u51fa\u7684\u6587\u4ef6\u8d44\u6e90\u3002\n */\nclass BannerWebpackPlugin {\n  constructor(options = {}) {\n    this.options = options;\n  }\n  apply(compiler) {\n    compiler.hooks.emit.tapAsync(\n      "BannerWebpackPlugin",\n      (compilation, callback) => {\n        const extensions = ["js", "css"];\n        const assets = Object.keys(compilation.assets).filter((assetPath) => {\n          const splitted = assetPath.split(".");\n          const extension = splitted[splitted.length - 1];\n          return extensions.includes(extension);\n        });\n        const prefix = `/*\n* Author: ${this.options.author}\n*/        \n`;\n        assets.forEach((asset) => {\n          const source = compilation.assets[asset].source();\n          const content = prefix + source;\n          //\u4fee\u6539\u8d44\u6e90\n          compilation.assets[asset] = {\n            source() {\n              return content;\n            },\n            size() {\n              return content.length;\n            },\n          };\n        });\n        callback();\n      }\n    );\n  }\n}\nmodule.exports = BannerWebpackPlugin;\n')),(0,l.kt)("h2",{id:"cleanwebpackplugin"},"CleanWebpackPlugin"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"/**\n * \u5728webpack\u6253\u5305\u8f93\u51fa\u524d\u5c06\u4e0a\u6b21\u6253\u5305\u5185\u5bb9\u6e05\u7a7a\n * 1. \u5982\u4f55\u5728\u6253\u5305\u8f93\u51fa\u524d\u6267\u884c\uff1f\u9700\u8981\u4f7f\u7528compiler.hooks.emit\u94a9\u5b50\uff0c\u5b83\u662f\u6253\u5305\u8f93\u51fa\u524d\u89e6\u53d1\n * 2. \u5982\u4f55\u6e05\u7a7a\u4e0a\u6b21\u6253\u5305\u5185\u5bb9\uff1f\n *    \u83b7\u53d6\u6253\u5305\u8f93\u51fa\u76ee\u5f55 \u901a\u8fc7compiler\u5bf9\u8c61\n *    \u901a\u8fc7\u6587\u4ef6\u64cd\u4f5c\u6e05\u7a7a\u5185\u5bb9 \u901a\u8fc7compiler.outputFileSystem\u64cd\u4f5c\u6587\u4ef6\n */\nclass CleanWebpackPlugin {\n  apply(compiler) {\n    const outputPath = compiler.outputPath || compiler.options.output.path;\n    const fs = compiler.outputFileSystem;\n    compiler.hooks.emit.tap(\"CleanWebpackPlugin\", (compilation) => {\n      this.removeFiles(fs, outputPath);\n    });\n  }\n  removeFiles(fs, filepath) {\n    // \u60f3\u8981\u5220\u9664\u6253\u5305\u8f93\u51fa\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u8d44\u6e90\uff0c\u9700\u8981\u5148\u5c06\u76ee\u5f55\u4e0b\u7684\u8d44\u6e90\u5220\u9664\uff0c\u624d\u80fd\u5220\u9664\u8fd9\u4e2a\u76ee\u5f55\n    const files = fs.readdirSync(filepath); // ['images', 'index.html', 'js']\n    files.forEach((file) => {\n      const path = `${filepath}/${file}`;\n      const fileStat = fs.statSync(path);\n      if (fileStat.isDirectory) {\n        this.removeFiles(fs, path);\n      } else {\n        fs.unlinkSync(path);\n      }\n    });\n  }\n}\nmodule.exports = CleanWebpackPlugin;\n")),(0,l.kt)("h2",{id:"analyzewepackplugin"},"AnalyzeWepackPlugin"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'/**\n * \u5206\u6790webpack\u6253\u5305\u8d44\u6e90\u5927\u5c0f\uff0c\u5e76\u8f93\u51fa\u5206\u6790\u6587\u4ef6\n * \u5728\u54ea\u505a\uff1fcompiler.hooks.emit, \u5b83\u662f\u5728\u6253\u5305\u8f93\u51fa\u524d\u89e6\u53d1\u6211\u4eec\u9700\u8981\u5206\u6790\u8d44\u6e90\u5927\u5c0f\u540c\u65f6\u6dfb\u52a0\u4e0a\u5206\u6790\u540e\u7684md\u6587\u4ef6\n */\nclass AnalyzeWebpackPlugin {\n  apply(compiler) {\n    compiler.hooks.emit.tap("AnalyzeWebpackPlugin", (compilation) => {\n      const assets = Object.entries(compilation.assets);\n      let content = `| \u8d44\u6e90\u540d\u79f0 | \u8d44\u6e90\u5927\u5c0f |\n| --- | --- |`;\n      assets.forEach(([filename, file]) => {\n        content += `\\n| ${filename} | ${Math.random(file.size() / 1024)}kb |`;\n      });\n      compilation.assets["analyze.md"] = {\n        source() {\n          return content;\n        },\n        size() {\n          return content.length;\n        },\n      };\n    });\n  }\n}\n')),(0,l.kt)("h2",{id:"inlinechunkwebpackplugin"},"InlineChunkWebpackPlugin"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},'/**\n * webpack\u6253\u5305\u751f\u6210\u7684runtime\u6587\u4ef6\u592a\u5c0f\u4e86\uff0c\u989d\u5916\u53d1\u9001\u8bf7\u6c42\u6027\u80fd\u4e0d\u597d\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u5176\u5185\u8054\u5230js\u4e2d\u53bb\uff0c\u4ece\u800c\u51cf\u5c11\u8bf7\u6c42\u6570\u91cf\n * 1. \u6211\u4eec\u9700\u8981\u501f\u52a9html-webpack-plugin\u6765\u5b9e\u73b0\n *    \u5728html-webpack-plugin\u8f93\u51faindex.html\u524d\u5c06\u5185\u8054runtime\u6ce8\u5165\u8fdb\u53bb\n *    \u5220\u9664\u591a\u4f59\u7684runtime\u6587\u4ef6\n * 2. \u5982\u4f55\u64cd\u4f5chtml-webpack-plugin\n */\nconst HtmlWebpackPlugin = require("safe-require")("html-webpack-plugin");\nclass InlineChunkWebpackPlugin {\n  constructor(tests) {\n    this.tests = tests;\n  }\n  apply(compiler) {\n    compiler.hooks.compilation.tap(\n      "InlineChunkWebpackPlugin",\n      (compilation) => {\n        const hooks = HtmlWebpackPlugin.getHooks(compilation);\n        hooks.alterAssetTagGroups.tap("InlineChunkWebpackPlugin", (assets) => {\n          assets.headTags = this.getInlineChunk(\n            assets.headTags,\n            compilation.assets\n          );\n          assets.bodyTags = this.getInlineChunk(\n            assets.bodyTags,\n            compilation.assets\n          );\n        });\n        // \u5220\u9664runtime\u6587\u4ef6\n        hooks.afterEmit.tap("InlineChunkWebpackPlugin", () => {\n          Object.keys(compilation.assets).forEach((filePath) => {\n            if (this.tests.some((test) => test.test(filePath))) {\n              // if (/runtime(.*)\\.js$/g.test(filePath)) {\n              delete compilation.assets[filePath];\n            }\n          });\n        });\n      }\n    );\n  }\n  getInlineChunk(tags, assets) {\n    return tags.map((tag) => {\n      if (tag.tagName !== "script") return tag;\n      const filePath = tag.attributes.src;\n      if (!filePath) return tag;\n      if (!this.tests.some((test) => test.test(filePath))) return tag;\n      if (!/runtime(.*)\\.js$/g.test(filePath)) return tag;\n      return {\n        tagName: "script",\n        innerHTML: assets[filePath].source(),\n        closeTag: true,\n      };\n    });\n  }\n}\n')))}u.isMDXComponent=!0}}]);